/**
 * @fileOverview 企鹅医典，医学科普头条
 * @author yeonzhou
 * @version v1.0.5
 */
var routes=[];window.sessionStorage.VUE_NAVIGATION&&(routes=JSON.parse(window.sessionStorage.VUE_NAVIGATION));var Routes=routes;function genKey(){return"xxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function getKey(e,t){return(e.name||e.path)+"?"+e.query[t]}function matches(e,t){return Array.isArray(e)?e.indexOf(t)>-1:"string"==typeof e&&e.split(",").indexOf(t)>-1}function remove(e,t){if(e.length){var n=e.indexOf(t);if(n>-1)return e.splice(n,1)}}function pruneCacheEntry(e,t,n,r){var o=e[t];!o||r&&o.tag===r.tag||o.componentInstance.$destroy(),e[t]=null,remove(n,t)}function isObjEqual(e,t){if(e===t)return!0;var n=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(t);if(n.length!==r.length)return!1;var o=!0,a=!1,i=void 0;try{for(var s,u=n[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var c=s.value;if(e[c]!==t[c])return!1}}catch(e){a=!0,i=e}finally{try{!o&&u.return&&u.return()}finally{if(a)throw i}}return!0}var Navigator=function(e,t,n){return{record:function(t,r,o){var a=getKey(t,n);if(o)!function(t,n,r){var o={route:n},a={route:r},i=Routes;a.name=i[i.length-1]||null,o.name=t,i.splice(Routes.length-1,1,t),window.sessionStorage.VUE_NAVIGATION=JSON.stringify(i),e.$emit("replace",o,a)}(a,t,r);else{var i=Routes.lastIndexOf(a);-1===i?function(t,n,r){var o={route:n},a={route:r},i=Routes;a.name=i[i.length-1]||null,o.name=t,i.push(t),window.sessionStorage.VUE_NAVIGATION=JSON.stringify(i),e.$emit("forward",o,a)}(a,t,r):i===Routes.length-1?function(t,n){var r={route:t},o={route:n},a=Routes;r.name=o.name=a[a.length-1],e.$emit("refresh",r,o)}(t,r):function(t,n,r){var o={route:n},a={route:r},i=Routes;a.name=i[i.length-1],o.name=i[i.length-1-t],i.splice(Routes.length-t,t),window.sessionStorage.VUE_NAVIGATION=JSON.stringify(i),e.$emit("back",o,a)}(Routes.length-1-i,t,r)}},reset:function(){Routes.splice(0,Routes.length),window.sessionStorage.VUE_NAVIGATION=JSON.stringify([]),e.$emit("reset")}}},NavComponent=function(e){return{name:"navigation",abstract:!0,props:{include:[String,Array],exclude:[String,Array],max:[String,Number]},data:function(){return{routes:Routes}},computed:{},watch:{routes:function(e){for(var t in this.cache)if(!matches(e,t)){var n=this.cache[t];n&&n.componentInstance.$destroy(),delete this.cache[t]}}},created:function(){this.cache={},this.keys=[]},destroyed:function(){for(var e in this.cache)pruneCacheEntry(this.cache,e,this.keys)},render:function(){var t=this.$slots.default?this.$slots.default[0]:null;if(t){t.key=t.key||(t.isComment?"comment":t.tag);var n=this.cache,r=this.keys,o=getKey(this.$route,e);-1===t.key.indexOf(o)&&(t.key="__navigation-"+o+"-"+t.key),n[o]?(t.key===n[o].key?t.componentInstance=n[o].componentInstance:(n[o].componentInstance.$destroy(),n[o]=t),remove(r,o),r.push(o)):(n[o]=t,r.push(o),this.max&&r.length>parseInt(this.max)&&pruneCacheEntry(n,r[0],r,this._vnode)),t.data.keepAlive=!0}return t}}},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var index={install:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.router,r=t.moduleName,o=void 0===r?"navigation":r,a=t.keyName,i=void 0===a?"VNK":a;if(n){var s=new e,u=Navigator(s,o,i),c=n.replace.bind(n),f=!1;n.replace=function(e,t,n){f=!0,c(e,t,n)},n.beforeEach(function(e,t,n){if(e.query[i])n();else{var r=_extends({},e.query);e.path===t.path&&isObjEqual(_extends({},e.query,_defineProperty({},i,null)),_extends({},t.query,_defineProperty({},i,null)))&&t.query[i]&&(f=!0),r[i]=genKey(),n({path:e.path,query:r,replace:f||!t.query[i],hash:e.hash||""})}}),n.afterEach(function(e,t){u.record(e,t,f),f=!1}),e.component("navigation",NavComponent(i)),e.navigation=e.prototype.$navigation={on:function(e,t){s.$on(e,t)},once:function(e,t){s.$once(e,t)},off:function(e,t){s.$off(e,t)},getRoutes:function(){return Routes.slice()},cleanRoutes:function(){return u.reset()}}}else console.error("vue-navigation need options: router")}};export default index;